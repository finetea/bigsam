# make tmp table to count siu per each FP
-- drop table train_tmp;
create table train_tmp as
select cllt_fp_prno as fp, siu_cust_yn as yn, count(1) as cnt from train
where class='train'
group by cllt_fp_prno, siu_cust_yn;



# count y, n for each FP
create table train_yn as
select 
distinct(a.fp), 
case when b.yn IS NULL then 0 else b.cnt end as y_cnt,
case when c.yn IS NULL then 0 else c.cnt end as n_cnt
from train_tmp as a 
left join train_tmp b on (a.fp = b.fp and b.yn='Y')
left join train_tmp c on (a.fp = c.fp and c.yn='N')


# bad fp's siu count
select siu_cust_yn, count(1) as cnt
from train a 
where a.CLLT_FP_PRNO in (select fp from train_yn where y_cnt / (y_cnt+n_cnt+1) >= 0.80) 
group by siu_cust_yn;



# find siu from test set
create table result as
select distinct(cust_id), siu_cust_yn, 
case when CLLT_FP_PRNO in ('7413', '6824', '14725', '15064', '21834', '11299', '12657', '3255', '939', '21545', '21346', '6282', '8331', '12478', '8519', '12942', '6058', '4109', '7334', '20987', '21880', '6352', '4122', '11890', '1271', '17196', '4819', '20267', '21596', '5537', '7691', '20578', '15010', '19495', '8611', '2397', '22068', '6849', '14184', '18022', '14964', '15770', '17630', '8662', '2399', '5728', '20727', '142', '1245', '1238', '11869', '17339', '19881', '94', '12825', '20685', '13830', '12120', '13172', '10626', '8552', '15428', '10454', '11874', '9270', '8829', '16470', '3257', '21564', '18372', '22035', '3398', '20874', '22313', '6670', '2023', '13806', '12240', '10370', '11117', '18865', '18313', '21280', '2215', '19209', '11600', '21270', '1231', '21260', '1015', '13634', '456', '13472', '7008', '8132', '13440', '2394', '8127', '7882', '20630', '21581', '21165', '7951', '16399', '11650', '18355'
) then 'Y' else 'N' end as predict_yn
from train a where class='test'

#select distinct(cust_id) from train where class='test' and cllt_fp_prno in (select fp from train_yn where y_cnt / (y_cnt+n_cnt+1) >= 0.70)



select predict_yn, count(1) from result group by predict_yn;

select siu_cust_yn, predict_yn, count(1) as cnt from result as a group by a.SIU_CUST_YN, a.predict_yn




#################
# again

# bad fp's siu count
select siu_cust_yn, count(1) as cnt
from train a 
where a.CLLT_FP_PRNO in (select fp from train_yn where y_cnt / (y_cnt+n_cnt+1) >= 0.90) 
group by siu_cust_yn;



# find siu from test set
create table result2 as
select distinct(cust_id), siu_cust_yn, 
case when CLLT_FP_PRNO in ('10186', '10713', '11149', '12320', '12984', '1349', '13498', '13751', '14615', '1465', '14920', '14984', '15718', '16095', '16254', '17180', '17949', '18220', '18553', '1942', '20622', '20963', '21405', '21603', '21636', '22376', '2242', '22438', '22515', '22586', '22985', '23031', '23055', '23098', '23513', '24661', '24981', '25053', '25169', '25283', '25448', '25938', '25997', '26210', '26461', '26772', '27099', '27316', '27812', '28256', '28355', '28658', '28788', '29085', '29300', '29345', '29614', '29856', '29982', '30237', '30245', '30303', '30325', '30405', '30674', '3090', '31455', '3917', '4240', '4333', '4375', '457', '5111', '5123', '5722', '5948', '6254', '6781', '6858', '7036', '7348', '8259', '852', '8521', '8625', '8841', '8960', '9110', '9195', '9265', '9507', '9749'
) then 'Y' else 'N' end as predict_yn
from train a where class='test'

#select distinct(cust_id) from train where class='test' and cllt_fp_prno in (select fp from train_yn where y_cnt / (y_cnt+n_cnt+1) >= 0.70)



select predict_yn, count(1) from result2 group by predict_yn;

select siu_cust_yn, predict_yn, count(1) as cnt from result2 as a group by a.SIU_CUST_YN, a.predict_yn



#################
# again 2

# bad fp's siu count
select siu_cust_yn, count(1) as cnt
from train a 
where a.CLLT_FP_PRNO in (select fp from train_yn where y_cnt / (y_cnt+n_cnt+1) >= 0.70) 
group by siu_cust_yn;



# find siu from test set
create table result3 as
select distinct(cust_id), siu_cust_yn, 
case when CLLT_FP_PRNO in ('10003', '10022', '10071', '10074', '10142', '10148', '10153', '10186', '10228', '10321', '10353', '10369', '10558', '1062', '10639', '10653', '10713', '10742', '10894', '10937', '10956', '1101', '1103', '1110', '11149', '11255', '11308', '11334', '11341', '11358', '11390', '11485', '11599', '11638', '11690', '11735', '11787', '11853', '11872', '11890', '12053', '12063', '12075', '12077', '12096', '12229', '12245', '12320', '1234', '12382', '12471', '12474', '12558', '12565', '12572', '12679', '12706', '12721', '12784', '12799', '12857', '12934', '12984', '13018', '1310', '13117', '13149', '13170', '132', '13269', '13305', '13424', '13476', '1349', '13498', '13603', '13649', '13740', '13751', '13757', '13821', '13825', '13863', '13864', '13902', '13905', '13935', '13949', '13962', '14028', '14086', '1416', '14215', '14245', '14300', '14321', '14336', '14344', '1436', '14428', '14517', '14615', '1465', '14681', '14766', '14774', '14796', '14797', '14805', '14806', '14853', '14863', '14906', '14920', '14947', '14984', '15019', '15175', '1518', '15240', '15247', '15289', '15310', '15325', '15345', '15395', '15619', '15718', '15720', '15746', '15810', '15811', '15847', '15942', '16095', '16212', '16254', '16486', '16498', '16546', '16583', '16682', '16700', '16932', '17050', '17055', '17176', '17180', '17186', '17376', '17383', '17412', '17419', '17454', '17488', '17502', '17534', '17562', '17678', '17782', '17783', '17855', '17949', '17993', '18059', '1821', '18220', '18388', '184', '18492', '18551', '18553', '18623', '1863', '18769', '18970', '19037', '19057', '191', '19128', '1924', '1942', '19498', '19504', '19514', '1952', '19574', '19593', '20031', '20352', '20364', '20583', '20622', '20638', '20815', '20836', '20950', '20952', '20963', '21031', '21051', '21066', '21121', '21167', '21182', '21260', '2128', '2131', '21319', '21341', '21352', '2137', '21405', '21450', '21564', '21598', '21603', '21623', '21636', '21729', '21757', '21803', '21867', '21928', '21981', '22014', '22023', '22036', '22061', '22075', '22221', '22249', '22311', '22320', '22324', '22353', '22376', '22398', '2242', '22438', '22444', '22493', '22505', '22515', '22566', '22586', '22628', '2268', '22891', '22899', '22963', '22985', '23014', '23031', '23055', '23098', '23433', '23450', '23513', '23612', '23689', '23693', '23701', '23816', '24002', '24190', '24265', '24292', '24300', '24513', '24520', '24542', '2457', '2459', '24613', '2462', '24661', '24763', '24981', '25009', '25013', '25015', '25040', '25053', '25058', '25072', '25105', '25118', '2513', '25169', '25195', '25283', '25308', '25317', '25326', '25353', '2537', '25378', '25381', '25436', '25448', '25509', '25515', '25535', '2560', '2563', '25658', '25701', '2571', '25792', '25869', '2593', '25938', '25992', '25997', '26024', '26054', '2606', '26099', '26124', '26156', '26210', '26326', '26457', '26461', '26695', '26772', '2678', '26794', '26861', '27016', '27047', '27089', '27099', '2710', '27284', '27316', '27384', '27418', '27478', '27630', '2765', '27738', '27798', '27812', '2782', '27839', '27950', '27987', '28112', '28242', '28256', '28276', '28355', '28356', '28359', '28390', '28452', '28658', '28725', '28757', '28759', '28774', '28788', '28934', '29036', '29085', '29150', '29154', '29156', '29157', '29158', '29213', '2927', '29300', '29345', '29498', '29510', '29614', '29628', '29673', '29677', '29710', '29768', '29786', '29856', '29982', '30008', '30046', '30063', '30124', '30125', '3022', '30237', '30245', '30283', '30289', '30303', '30325', '30378', '30395', '30399', '30405', '30505', '30548', '30575', '30622', '30624', '3065', '30674', '30752', '30796', '30827', '30834', '30835', '30883', '3090', '30928', '30951', '30981', '31135', '31162', '31175', '31180', '31181', '31198', '31219', '31257', '31410', '31455', '3153', '316', '3295', '3320', '3328', '3339', '3395', '3441', '3744', '3805', '3812', '3917', '398', '4062', '4111', '4224', '4240', '4333', '4350', '4375', '4376', '457', '4573', '4609', '4670', '4671', '4805', '4818', '4869', '4892', '497', '5001', '5071', '5111', '5123', '5150', '516', '5194', '5198', '5202', '5231', '525', '5266', '531', '533', '5342', '5481', '5484', '5486', '5506', '5511', '5620', '5722', '5737', '5742', '5907', '5936', '5948', '5953', '5993', '6076', '6085', '6126', '6200', '6254', '6301', '6337', '6364', '6551', '6575', '6623', '6669', '6700', '6732', '6781', '6858', '6905', '6937', '6950', '6977', '7036', '7043', '7066', '7100', '7122', '7300', '7345', '7348', '7364', '7417', '7468', '7555', '7598', '7651', '7688', '7766', '7903', '8081', '8099', '8124', '813', '8174', '8186', '8196', '8202', '8232', '8246', '8259', '8277', '8295', '830', '8362', '8409', '8489', '852', '8521', '8561', '8624', '8625', '8648', '8684', '8700', '8841', '8949', '8960', '8979', '9018', '9044', '9049', '9051', '9110', '9148', '9162', '9195', '9260', '9265', '9272', '9306', '942', '9507', '9526', '9534', '9579', '9697', '9749', '9753', '9769', '977', '9788', '9800', '9839', '9912', '9939', '9984'
) then 'Y' else 'N' end as predict_yn
from train a where class='test'

#select distinct(cust_id) from train where class='test' and cllt_fp_prno in (select fp from train_yn where y_cnt / (y_cnt+n_cnt+1) >= 0.70)

bigsam

select predict_yn, count(1) from result3 group by predict_yn;

select siu_cust_yn, predict_yn, count(1) as cnt from result3 as a group by a.SIU_CUST_YN, a.predict_yn